<?php require 'inc.php'; function curl_post($url,$data){ $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST"); curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); curl_setopt($ch, CURLOPT_USERAGENT, 'Mozilla/5.0 (compatible; MSIE 5.01; Windows NT 5.0)'); curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1); curl_setopt($ch, CURLOPT_AUTOREFERER, 1); curl_setopt($ch, CURLOPT_POSTFIELDS, $data); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); $tmpInfo = curl_exec($ch); if (curl_errno($ch)) { return curl_error($ch); } return $tmpInfo; } $orderid=$_REQUEST["orderid"]; $txnAmt=$_REQUEST["txnAmt"]; if($txnAmt!=""){ $txnAmt=number_format($txnAmt/100,2,".",""); } $data['platSeq'] = $_REQUEST["platSeq"]; $data['token'] = time().rand(100000,999999); $data['smsCode'] = $_REQUEST['smsCode']; if($data['platSeq']==""||$data['smsCode']==""){ echo "参数不能为空！";exit(); }  $TRANDATA = "platSeq=".$data['platSeq']."&token=".$data['token']."&smsCode=".$data['smsCode'];  $pi_key = openssl_pkey_get_private($private); openssl_sign($TRANDATA, $SIGN, $pi_key, OPENSSL_ALGO_SHA1); $SIGN = base64_encode($SIGN); $gateway = 'http://111.231.217.165:28080/Pay/tran/APIQuickPayAffirm'; $arr['MERCNUM'] = $MERCNUM; $arr['TRANDATA'] =$TRANDATA; $arr['SIGN'] = $SIGN ; $parameters=http_build_query($arr); $result=curl_post($gateway,$parameters); $resArr=json_decode($result,true); if(isset($resArr["RECODE"])&&$resArr["RECODE"]=="0000"){ echo "支付提交成功!<br />订单号：".$orderid."<br />金额：".$txnAmt."元"; }else{ echo isset($resArr["REMSG"])?$resArr["REMSG"]:"未知错误"; } ?>